<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:EasySave.ViewModels"
        xmlns:utils="using:EasySave.Utils"
        xmlns:v="using:EasySave.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="EasySave.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="EasySave - Version 2.0"
        Width="950" Height="650"
        Background="{DynamicResource AppBackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        utils:CursorUtils.ImagePath="{Binding CustomCursorPath}"
        Icon="/Assets/Icon.png">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<Window.Resources>
		<x:String x:Key="HoverCursorPath">avares://EasySave/Assets/cursor-hover.cur</x:String>
		<utils:TruncateConverter x:Key="TruncateConverter" MaxLength="50"/>
	</Window.Resources>

	<Window.Styles>
		<Style Selector="Button:pointerover">
			<Setter Property="utils:CursorUtils.ImagePath" Value="{StaticResource HoverCursorPath}"/>
		</Style>

		<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="Transparent" />
		</Style>

		<Style Selector="ListBoxItem:selected /template/ ContentPresenter#PART_ContentPresenter">
			<Setter Property="Background" Value="Transparent" />
		</Style>

		<Style Selector="ListBoxItem:pointerover Border.JobCard">
			<Setter Property="BorderBrush" Value="{DynamicResource SuccessBrush}"/>
			<Setter Property="BorderThickness" Value="2"/>
		</Style>
	</Window.Styles>

	<Grid RowDefinitions="Auto, *, Auto" Margin="30">

		<Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="0,0,0,25">
			<Grid Grid.Column="0">
				<Image Source="/Assets/EasySave_logo_white.png" Width="400" Height="120" Stretch="Uniform" HorizontalAlignment="Left"/>
			</Grid>
			<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="15" VerticalAlignment="Top" Margin="0,10,0,0">
				<Button Background="Transparent" Command="{Binding ShowSettingsCommand}" Cursor="Hand" ToolTip.Tip="{Binding T_settings_tooltip}">
					<TextBlock Text="⚙" FontSize="24" Foreground="{DynamicResource TextPrimaryBrush}"/>
				</Button>
			</StackPanel>
		</Grid>

		<Border Grid.Row="1" Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderMediumBrush}" BorderThickness="1" CornerRadius="8" Padding="15">
			<Grid RowDefinitions="Auto, *">
				<TextBlock Grid.Row="0" Text="{Binding T_save_sobs}" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,15"/>

				<ListBox Grid.Row="1" Background="Transparent" BorderThickness="0" ItemsSource="{Binding Jobs}" SelectionMode="Single">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Border Classes="JobCard" Background="{DynamicResource ControlBackgroundBrush}" BorderBrush="{DynamicResource BorderMediumBrush}" BorderThickness="1" CornerRadius="6" Padding="15" Margin="0,0,0,10">
								<Grid ColumnDefinitions="Auto, *, Auto">
									<Border Grid.Column="0" Background="{DynamicResource SuccessBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,15,0" VerticalAlignment="Center">
										<StackPanel Orientation="Horizontal">
											<TextBlock Text="ID " Foreground="{DynamicResource TextInvertedBrush}" FontWeight="Bold"/>
											<TextBlock Text="{Binding Id}" Foreground="{DynamicResource TextInvertedBrush}" FontWeight="Bold"/>
										</StackPanel>
									</Border>

									<StackPanel Grid.Column="1" VerticalAlignment="Center">
										<TextBlock Text="{Binding Name}" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="16" FontWeight="Bold"/>
										<StackPanel Orientation="Vertical" Margin="0,3,0,0">
											<StackPanel Orientation="Horizontal">
												<TextBlock Text="Source: " Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
												<TextBlock Text="{Binding Source, Converter={StaticResource TruncateConverter}}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
											</StackPanel>
											<StackPanel Orientation="Horizontal" Margin="0,5,0,0">
												<TextBlock Text="Cible: " Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
												<TextBlock Text="{Binding Destination, Converter={StaticResource TruncateConverter}}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
											</StackPanel>
										</StackPanel>
									</StackPanel>

									<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
										<Button Command="{Binding $parent[Window].DataContext.RunJob}" CommandParameter="{Binding}" Background="Transparent">
											<TextBlock Text="▷" FontSize="20" Foreground="{DynamicResource SuccessBrush}"/>
										</Button>
										<Button Command="{Binding $parent[Window].DataContext.EditJob}" CommandParameter="{Binding}" Background="Transparent">
											<TextBlock Text="✎" FontSize="20" Foreground="{DynamicResource TextPrimaryBrush}"/>
										</Button>
										<Button Command="{Binding $parent[Window].DataContext.DeleteJob}" CommandParameter="{Binding}" Background="Transparent">
											<TextBlock Text="❌" FontSize="16" Foreground="{DynamicResource DangerBrush}"/>
										</Button>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Grid>
		</Border>

		<Grid Grid.Row="2" ColumnDefinitions="*, Auto" Margin="0,25,0,0">
			<Border Grid.Column="0"
                    IsVisible="{Binding IsStatusVisible}"
                    Background="{DynamicResource SuccessBackgroundBrush}"
                    Padding="15,8"
                    CornerRadius="6"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center">
				<StackPanel Orientation="Horizontal" Spacing="10">
					<TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextInvertedBrush}" FontWeight="Medium"/>
				</StackPanel>
			</Border>

			<Button Grid.Column="1"
                    Content="{Binding T_create_job}"
                    Command="{Binding CreateJob}"
                    Width="160" Height="45"
                    VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Background="{DynamicResource SuccessBrush}"
                    Foreground="{DynamicResource TextInvertedBrush}" FontWeight="Bold" CornerRadius="6" Cursor="Hand"/>
		</Grid>

		<Border Grid.Row="0" Grid.RowSpan="3" Background="{DynamicResource OverlayBrush}"
                IsVisible="{Binding CurrentViewModel, Converter={x:Static ObjectConverters.IsNotNull}}">
			<ContentControl Content="{Binding CurrentViewModel}">
				<ContentControl.DataTemplates>
					<DataTemplate DataType="{x:Type vm:SettingsViewModel}">
						<v:SettingsView/>
					</DataTemplate>
					<DataTemplate DataType="{x:Type vm:JobSettingsViewModel}">
						<v:JobSettingsView/>
					</DataTemplate>
					<DataTemplate DataType="{x:Type vm:RunJobsViewModel}">
						<v:RunJobsView/>
					</DataTemplate>
				</ContentControl.DataTemplates>
			</ContentControl>
		</Border>
	</Grid>
</Window>